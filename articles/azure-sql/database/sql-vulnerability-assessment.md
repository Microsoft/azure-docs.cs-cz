---
title: Posouzení ohrožení zabezpečení SQL
titleSuffix: Azure SQL Database & SQL Managed Instance & Azure Synapse Analytics
description: Přečtěte si, jak nakonfigurovat posouzení ohrožení zabezpečení SQL a interpretovat sestavy hodnocení na Azure SQL Database, spravované instance Azure SQL a Azure synapse Analytics.
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.custom: sqldbrb=3
ms.devlang: ''
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 02/11/2021
tags: azure-synapse
ms.openlocfilehash: 1719c5a7112ee32f86d0593d274a59638cf81a0e
ms.sourcegitcommit: 867cb1b7a1f3a1f0b427282c648d411d0ca4f81f
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/19/2021
ms.locfileid: "100376584"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>Posouzení ohrožení zabezpečení SQL vám pomůže identifikovat slabá místa databáze.
[!INCLUDE[appliesto-sqldb-sqlmi-asa](../includes/appliesto-sqldb-sqlmi-asa.md)]

Posouzení ohrožení zabezpečení SQL je snadno nakonfigurovaná služba, která může zjišťovat, sledovat a pomáhat při nápravě potenciálních ohrožení zabezpečení databáze. Můžete ji aktivně využít ke zlepšení zabezpečení vaší databáze.

Posouzení ohrožení zabezpečení je součástí nabídky [Azure Defender pro SQL](azure-defender-for-sql.md) , což je jednotný balíček pro pokročilé funkce zabezpečení SQL. K posouzení ohrožení zabezpečení se dá využít a spravovat prostřednictvím centrálního portálu Azure Defender pro SQL Portal.

> [!NOTE]
> Posouzení ohrožení zabezpečení je podporované pro Azure SQL Database, Azure SQL Managed instance a Azure synapse Analytics. Databáze v Azure SQL Database, Azure SQL Managed instance a Azure synapse Analytics se ve zbývající části tohoto článku společně nazývají databáze a server odkazuje na [Server](logical-servers.md) , který je hostitelem databází pro Azure SQL Database a Azure synapse.

## <a name="what-is-sql-vulnerability-assessment"></a>Co je posouzení ohrožení zabezpečení SQL?

Posouzení ohrožení zabezpečení SQL je služba, která poskytuje přehled o stavu zabezpečení. Posouzení ohrožení zabezpečení zahrnuje akční kroky pro řešení problémů se zabezpečením a vylepšení zabezpečení databáze. Může vám pomoci s monitorováním dynamického databázového prostředí, kde je obtížné sledovat a zdokonalit stav zabezpečení SQL.

Posouzení ohrožení zabezpečení je skenovací služba integrovaná do Azure SQL Database. Služba využívá znalostní bázi pravidel, která označují bezpečnostní hrozby. Zvýrazňuje odchylky od osvědčených postupů, jako jsou například nepřesné konfigurace, nadměrné oprávnění a nechráněná citlivá data.

Tato pravidla jsou založená na osvědčených postupech Microsoftu a zaměřuje se na problémy zabezpečení, které představují největší rizika pro vaši databázi a jejich cenná data. Zahrnují problémy na úrovni databáze a problémy se zabezpečením na úrovni serveru, jako jsou nastavení brány firewall serveru a oprávnění na úrovni serveru.

Výsledky kontroly zahrnují akční kroky k vyřešení jednotlivých problémů a v případě potřeby vám poskytnou přizpůsobené skripty pro nápravu. Můžete přizpůsobit sestavu posouzení pro vaše prostředí nastavením přijatelného směrného plánu pro:

- Konfigurace oprávnění
- Konfigurace funkcí
- Nastavení databáze

## <a name="configure-vulnerability-assessment"></a>Konfigurace posouzení ohrožení zabezpečení

Při konfiguraci posouzení ohrožení zabezpečení proveďte následující kroky:

1. V [Azure Portal](https://portal.azure.com)otevřete konkrétní prostředek v Azure SQL Database, databázi spravované instance SQL nebo Azure synapse.

1. Pod záhlavím **zabezpečení** vyberte **Security Center**.

1. Výběrem možnosti **Konfigurovat** na odkaz otevřete podokno nastavení Azure Defender pro SQL pro celý server nebo spravovanou instanci.

    :::image type="content" source="media/sql-vulnerability-assessment/opening-sql-configuration.png" alt-text="Otevření programu Defender pro konfiguraci SQL":::

    > [!NOTE]
    > Posouzení ohrožení zabezpečení SQL vyžaduje, aby plán **Azure Defenderu pro SQL** mohl spouštět kontroly. Další informace o tom, jak povolit Azure Defender pro SQL, najdete v tématu [Azure Defender pro SQL](azure-defender-for-sql.md).

1. Na stránce **nastavení serveru** definujte nastavení pro Azure Defender pro SQL:

    :::image type="content" source="media/sql-vulnerability-assessment/sql-vulnerability-scan-settings.png" alt-text="Konfigurace prohledávání posouzení ohrožení zabezpečení SQL":::

    1. Nakonfigurujte účet úložiště, ve kterém se budou ukládat výsledky kontroly pro všechny databáze na serveru nebo na spravované instanci. Informace o účtech úložiště najdete v tématu informace [o účtech úložiště Azure](../../storage/common/storage-account-create.md).

        > [!TIP]
        > Další informace o ukládání kontrol ohrožení zabezpečení za brány firewall a virtuální sítě najdete v článku [ukládání výsledků kontroly vyhodnocování ohrožení zabezpečení v účtu úložiště přístupném za brány firewall a virtuální sítě](sql-database-vulnerability-assessment-storage.md).

    1. Chcete-li nakonfigurovat posuzování ohrožení zabezpečení, aby automaticky spouštěla týdenní prohledávání za účelem zjištění chybných konfigurací zabezpečení, nastavte **pravidelné opakované kontroly** na **zapnuto**. Výsledky se odesílají na e-mailové adresy, které poskytnete v **sestavách odeslat kontrolu na**. Můžete také odeslat e-mailová oznámení správcům a vlastníkům předplatného tak, že povolíte **také odesílání e-mailových oznámení správcům a vlastníkům**

1. Prohledávání posouzení ohrožení zabezpečení SQL je také možné spustit na vyžádání:

    1. Na stránce **Security Center** prostředku vyberte **Zobrazit další zjištění v části posouzení ohrožení zabezpečení** pro přístup k výsledkům kontroly z předchozích kontrol.

        :::image type="content" source="media/sql-vulnerability-assessment/view-additional-findings-link.png" alt-text="Otevření výsledků kontroly a možností ručního prohledávání":::

    1. Chcete-li spustit kontrolu na vyžádání pro kontrolu ohrožení zabezpečení v databázi, vyberte možnost **Prohledat** na panelu nástrojů:

        :::image type="content" source="media/sql-vulnerability-assessment/on-demand-vulnerability-scan.png" alt-text="Vyberte možnost Prohledat, pokud chcete spustit kontrolu posouzení ohrožení zabezpečení na vyžádání vašeho prostředku SQL.":::


  > [!NOTE]
  > Kontrola je odlehčená a bezpečná. Spuštění a je výhradně jen pro čtení, trvá několik sekund. Neprovádí žádné změny v databázi.

## <a name="remediate-vulnerabilities"></a>Napravit ohrožení zabezpečení

Po dokončení kontroly ohrožení zabezpečení se sestava zobrazí v Azure Portal. Tato sestava uvádí:

- Přehled stavu zabezpečení
- Počet nalezených problémů a
- Souhrn podle závažnosti rizik
- Seznam zjištění pro další šetření

:::image type="content" source="media/sql-vulnerability-assessment/sample-sql-vulnerabilities-report.png" alt-text="Zpráva o kontrole sampl ze skeneru pro posouzení ohrožení zabezpečení SQL":::

Náprava zjištěných slabých míst:

1. Zkontrolujte výsledky a určete, která z nálezů sestavy jsou skutečnými problémy zabezpečení vašeho prostředí.

1. Výběrem každého neúspěšného výsledku pochopíte jeho dopad a důvod selhání kontroly zabezpečení.

    > [!TIP]
    > Stránka s podrobnostmi o zjištěních obsahuje informace o nápravě, které objasňují, jak tento problém vyřešit.

    :::image type="content" source="media/sql-vulnerability-assessment/examining-vulnerability-findings.gif" alt-text="Kontrola zjištění ohrožení zabezpečení":::

1. Při kontrole výsledků hodnocení můžete označit konkrétní výsledky jako přijatelné *standardní hodnoty* ve vašem prostředí. Směrný plán je v podstatě přizpůsobením způsobu hlášení výsledků. V následných kontrolách se výsledky, které odpovídají směrnému plánu, považují za průchody. Po vytvoření směrného plánu zabezpečení vyhodnocování ohrožení zabezpečení pouze hlásí pouze odchylky ze směrného plánu. Tímto způsobem můžete zaměřit pozornost na relevantní problémy.

    :::image type="content" source="media/sql-vulnerability-assessment/baseline-approval.png" alt-text="Schválení hledání jako směrného plánu pro budoucí kontroly":::

1. Pokud změníte směrné plány, použijte tlačítko **Prohledat** a spusťte kontrolu na vyžádání a zobrazte si přizpůsobenou sestavu. Všechna zjištění, která jste přidali do směrného plánu, se nyní zobrazí v seznamu s oznámením, že byla **předána z** důvodu změn standardních hodnot.

    :::image type="content" source="media/sql-vulnerability-assessment/passed-per-custom-baseline.png" alt-text="Úspěšná vyhodnocení označující, že byla předána na vlastní standardní hodnoty":::

Vaše prohledávání posouzení ohrožení zabezpečení se teď dá použít k zajištění toho, že vaše databáze udržuje vysokou úroveň zabezpečení a že jsou splněné zásady vaší organizace. 

## <a name="advanced-capabilities"></a>Pokročilé možnosti

### <a name="export-an-assessment-report"></a>Export sestavy posouzení

Vyberte **Exportovat výsledky kontroly** , chcete-li vytvořit sestavu aplikace Excel ke stažení pro výsledek kontroly. Tato sestava obsahuje kartu Souhrn, která zobrazuje souhrn posouzení. Sestava obsahuje všechny neúspěšné kontroly. Obsahuje také kartu **výsledky** , která obsahuje úplnou sadu výsledků kontroly. Výsledky zahrnují všechny kontroly, které byly spuštěny, a podrobnosti o výsledku pro každý z nich.

### <a name="view-scan-history"></a>Zobrazení historie prohledávání

V podokně posouzení ohrožení zabezpečení vyberte **historii kontroly** , chcete-li zobrazit historii všech kontrol, které byly dříve spuštěny v této databázi. Kliknutím na konkrétní kontrolu v seznamu zobrazíte podrobné výsledky této kontroly.

## <a name="manage-vulnerability-assessments-programmatically"></a>Správa vyhodnocení ohrožení zabezpečení prostřednictvím kódu programu

### <a name="using-azure-powershell"></a>Použití Azure Powershell

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]
> [!IMPORTANT]
> PowerShell Azure Resource Manager modul je stále podporován, ale všechny budoucí vývojové prostředí jsou pro modul AZ. SQL. Tyto rutiny naleznete v tématu [AzureRM. SQL](/powershell/module/AzureRM.Sql/). Argumenty pro příkazy v modulech AZ a v modulech AzureRm jsou v podstatě identické.

Pomocí rutin Azure PowerShell můžete programově spravovat posouzení ohrožení zabezpečení. Podporované rutiny jsou:

| Název rutiny jako odkaz | Description |
| :-------------------- | :---------- |
| [Clear – AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Vymaže směrný plán pravidla posouzení ohrožení zabezpečení.<br/>Nejdřív nastavte základní hodnotu před použitím této rutiny k jejímu vymazání. |
| [Clear – AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | Vymaže nastavení posouzení ohrožení zabezpečení databáze. |
| [Clear – AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Vymaže standardní hodnotu pravidla posouzení ohrožení zabezpečení spravované databáze.<br/>Nejdřív nastavte základní hodnotu před použitím této rutiny k jejímu vymazání. |
| [Clear – AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Vymaže nastavení posouzení ohrožení zabezpečení spravované databáze. |
| [Clear – AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceVulnerabilityAssessmentSetting) | Vymaže nastavení posouzení ohrožení zabezpečení spravované instance. |
| [Convert – AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | Převede výsledky kontroly vyhodnocování ohrožení zabezpečení databáze na excelový soubor. |
| [Convert – AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Převede výsledky kontroly vyhodnocování ohrožení zabezpečení spravované databáze na excelový soubor. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Získá směrný plán pravidla posouzení ohrožení zabezpečení databáze pro dané pravidlo. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Získá standardní hodnotu pravidla posouzení ohrožení zabezpečení spravované databáze pro dané pravidlo. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | Získá všechny záznamy kontroly posouzení ohrožení zabezpečení přidružené k dané databázi. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord) | Získá všechny záznamy kontroly posouzení ohrožení zabezpečení přidružené k dané spravované databázi. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | Vrátí nastavení posouzení ohrožení zabezpečení databáze. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Vrátí nastavení posouzení ohrožení zabezpečení spravované databáze. |
| [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Nastaví směrný plán pravidla posouzení ohrožení zabezpečení. |
| [Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Nastaví směrný plán pravidla posouzení ohrožení zabezpečení pro spravovanou databázi. |
| [Spustit – AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | Spustí začátek kontroly posouzení ohrožení zabezpečení v databázi. |
| [Spustit – AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Spustí začátek kontroly posouzení ohrožení zabezpečení ve spravované databázi. |
| [Update – AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | Aktualizuje nastavení posouzení ohrožení zabezpečení databáze. |
| [Update – AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Aktualizuje nastavení posouzení ohrožení zabezpečení spravované databáze. |
| [Update – AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceVulnerabilityAssessmentSetting) | Aktualizuje nastavení posouzení ohrožení zabezpečení spravované instance. |
| &nbsp; | &nbsp; |

Příklad skriptu najdete v tématu [Podpora PowerShellu pro posouzení ohrožení zabezpečení Azure SQL](/archive/blogs/sqlsecurity/azure-sql-vulnerability-assessment-now-with-powershell-support).

### <a name="using-resource-manager-templates"></a>Použití šablon Azure Resource Manageru

Chcete-li konfigurovat směrné plány pro posouzení ohrožení zabezpečení pomocí Azure Resource Manager šablon, použijte `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines` typ.

Před přidáním standardních hodnot se ujistěte, že jste povolili `vulnerabilityAssessments` .

Tady je příklad, jak definovat pravidlo standardních hodnot VA2065 do `master` databáze a VA1143 do `user` databáze jako prostředky v šabloně správce prostředků:

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

`master`V případě databáze a `user` databáze jsou názvy prostředků definované odlišně:

- Hlavní databáze-"název": "[Concat (Parameters (' server_name '); '/', Parameters (' database_name '), '/default/VA2065/<b>Master</b>')]";
- Uživatelská databáze-"název": "[Concat (Parameters (' server_name '), '/', parametry (' database_name '), '/default/VA2065/<b>Default</b>')]";

Pro zpracování logických typů jako true/false nastavte výsledek směrného plánu s binárním vstupem jako "1"/"0".

```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>Další kroky  

- Přečtěte si další informace o [Azure Defenderu pro SQL](azure-defender-for-sql.md).
- Přečtěte si další informace o [zjišťování a klasifikaci dat](data-discovery-and-classification-overview.md).
- Další informace o [ukládání výsledků kontroly posouzení ohrožení zabezpečení v účtu úložiště přístupném za branami firewall a virtuální sítě](sql-database-vulnerability-assessment-storage.md).