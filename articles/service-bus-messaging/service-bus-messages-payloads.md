---
title: Azure Service Bus zprávy, datové části a serializace | Microsoft Docs
description: Tento článek poskytuje přehled Azure Service Busch zpráv, datových částí, směrování zpráv a serializaci.
ms.topic: article
ms.date: 01/29/2021
ms.openlocfilehash: e1baca1cd3dedee5917670a00b62c68752b5e4b8
ms.sourcegitcommit: 910a1a38711966cb171050db245fc3b22abc8c5f
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/19/2021
ms.locfileid: "101095101"
---
# <a name="messages-payloads-and-serialization"></a>Zprávy, datové části a serializace

Microsoft Azure Service Bus zpracovává zprávy. Zprávy obsahují datovou část a metadata. Metadata jsou ve formě vlastností dvojice klíč-hodnota a popisují datovou část a poskytuje pokyny pro Service Bus a aplikace. V některých případech stačí k přenosu informací, které odesílatel chce komunikovat s přijímači, jenom metadata, a datová část zůstane prázdná.

Objektový model oficiálních Service Bus klientů pro .NET a Java odráží abstraktní strukturu Service Bus zprávy, která je namapována na a z přenosových protokolů Service Bus podporuje.
 
Service Bus zpráva se skládá z binárního oddílu datové části, který Service Bus nikdy nezpracovává v žádné formě na straně služby a dvou sadách vlastností. *Vlastnosti zprostředkovatele* jsou předdefinovány systémem. Tyto předdefinované vlastnosti buď kontrolují funkce na úrovni zprávy uvnitř zprostředkovatele, nebo mapují na společné a standardizované položky metadat. *Vlastnosti uživatele* jsou kolekce párů klíč-hodnota, které mohou být definovány a nastaveny aplikací.
 
Předdefinované vlastnosti zprostředkovatele jsou uvedeny v následující tabulce. Názvy se používají se všemi oficiálními klientskými rozhraními API a také v objektu [BrokerProperties](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) JSON mapování protokolu HTTP.
 
Ekvivalentní názvy používané na úrovni protokolu AMQP jsou uvedeny v závorkách. 

| Název vlastnosti                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  [`ContentType`](/dotnet/api/microsoft.azure.servicebus.message.contenttype) (Content-Type)           | Volitelně popisuje datovou část zprávy s popisovačem po formátu RFC2045, oddíl 5; například `application/json` .                                                                                                                                                                                                                                                                                             |
|  [`CorrelationId`](/dotnet/api/microsoft.azure.servicebus.message.correlationid#Microsoft_Azure_ServiceBus_Message_CorrelationId) (korelační-ID)       | Umožňuje aplikaci pro účely korelace určit kontext pro zprávu. například odráží zprávu **MessageID** zprávy, na kterou je odpovězeno.                                                                                                                                                                                                                                                                  |
| [`DeadLetterSource`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deadlettersource)                      | Nastavte pouze ve zprávách, které byly nedoručené a později se z fronty nedoručených zpráv předají do jiné entity. Určuje entitu, ve které byla zpráva nedoručena. Tato vlastnost je jen ke čtení.                                                                                                                                                                                                                                  |
| [`DeliveryCount`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount)                         | <p>Počet doručení, u kterých došlo k pokusu o tuto zprávu. Počet se zvýší, když vyprší platnost zámku zprávy, nebo je zpráva explicitně opuštěna příjemcem. Tato vlastnost je jen ke čtení.</p> <p>Po zavření základního připojení AMQP se počet doručování nezvyšuje.</p>                                                                                                                                                                                                                                                 |
| [`EnqueuedSequenceNumber`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedsequencenumber)                | U zpráv, které byly předávány, tato vlastnost odráží pořadové číslo, které bylo původně přiřazeno zprávě v původním bodě odeslání. Tato vlastnost je jen ke čtení.                                                                                                                                                                                                                                                                |
| [`EnqueuedTimeUtc`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedtimeutc)                       | ČAS UTC, kdy byla zpráva přijata a uložena v entitě. Tuto hodnotu lze použít jako autoritativní a neutrální indikátor doby doručení, pokud příjemce nechce důvěřovat hodinám odesílatele. Tato vlastnost je jen ke čtení.                                                                                                                                                                                                   |
|  [`ExpiresAtUtc`](/dotnet/api/microsoft.azure.servicebus.message.expiresatutc) (absolutní – doba vypršení platnosti) | ČAS UTC, kdy je zpráva označena k odebrání a již není k dispozici pro načtení z entity z důvodu vypršení její platnosti. Vlastnost vypršení platnosti je řízena vlastností **TimeToLive** a tato vlastnost je vypočítána z EnqueuedTimeUtc + TimeToLive. Tato vlastnost je jen ke čtení.                                                                                                                                                                           |
| [`ForcePersistence`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence)                      | U front nebo témat s [`EnableExpress`](/dotnet/api/microsoft.servicebus.messaging.queuedescription.enableexpress) nastaveným příznakem lze tuto vlastnost nastavit tak, aby označovala, že je nutné zprávu před potvrzením uchovat na disk. Toto chování je standardní chování všech neexpresních entit.                                                                                                                                                                                                         |
| [`Label`](/dotnet/api/microsoft.azure.servicebus.message.label) závislosti                       | Tato vlastnost umožňuje aplikaci označit účel zprávy přijímači standardizovaným způsobem, podobně jako řádek předmětu e-mailu.                                                                                                                                                                                                                                                                                  |
| [`LockedUntilUtc`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.lockeduntilutc)                        | Pro zprávy načtené v režimu zámku (režim příjmu bez předběžného vyrovnání) Tato vlastnost odráží čas UTC od času, kdy zpráva zůstane uzamčena ve frontě nebo v předplatném. Po vypršení platnosti zámku se [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount) zvýší a zpráva je znovu dostupná pro načtení. Tato vlastnost je jen ke čtení.                                                                                                                         |
| [`LockToken`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.locktoken)                             | Token zámku je odkaz na zámek, který je držen zprostředkovatelem v režimu pro příjem *náhledu bez zámku* . Token se dá použít k trvalému připnutí zámku prostřednictvím rozhraní API pro [odložení](message-deferral.md) a s tím se zpráva převezme z normálního toku stavu doručení. Tato vlastnost je jen ke čtení.                                                                                                                                                               |
| [`MessageId`](/dotnet/api/microsoft.azure.servicebus.message.messageid) (ID zprávy)                | Identifikátor zprávy je hodnota definovaná aplikací, která jednoznačně identifikuje zprávu a její datovou část. Identifikátor je řetězec volného formátu a může odrážet identifikátor GUID nebo identifikátor odvozený z kontextu aplikace. Je-li povoleno, funkce [zjišťování duplicit](duplicate-detection.md) identifikuje a odebere druhé a další odeslání zpráv se stejným parametrem **MessageID**.                                                                |
| [`PartitionKey`](/dotnet/api/microsoft.azure.servicebus.message.partitionkey)                          | U [dělených entit](service-bus-partitioning.md)je při nastavení této hodnoty možné přiřazovat související zprávy do stejného interního oddílu, aby bylo pořadí pořadí odeslání správně zaznamenáno. Oddíl je vybraný funkcí hash nad touto hodnotou a nedá se vybrat přímo. U entit pracujících s relací Přepisuje vlastnost **SessionID** tuto hodnotu.                                                                                                       |
| [`ReplyTo`](/dotnet/api/microsoft.azure.servicebus.message.replyto) (odpověď na)                    | Tato volitelná a definovaná hodnota aplikace představuje standardní způsob, jak vyjádřit cestu k příjemci zprávy. Když odesílatel očekává odpověď, nastaví hodnotu na absolutní nebo relativní cestu fronty nebo tématu, která očekává, že se odpověď pošle.                                                                                                                                           |
| [`ReplyToSessionId`](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid) (odpověď-na skupinu – ID)  | Tato hodnota rozšiřuje informace **ReplyTo** a určuje, který **identifikátor SessionID** má být nastaven pro odpověď při odeslání do entity odpovědi.                                                                                                                                                                                                                                                                            |
| [`ScheduledEnqueueTimeUtc`](/dotnet/api/microsoft.azure.servicebus.message.scheduledenqueuetimeutc)               | U zpráv, které jsou k dispozici pouze pro načtení po prodlevě, tato vlastnost definuje UTC okamžitý čas, kdy bude zpráva logicky zařazena do fronty, sekvencovaná a následně zpřístupněna pro načtení.                                                                                                                                                                                                                 |
| [`SequenceNumber`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.sequencenumber)                        | Pořadové číslo je jedinečné 64 celé číslo, které je přiřazeno ke zprávě tak, jak je přijato a uloženo zprostředkovatelem a funguje jako jeho skutečný identifikátor. U dělených entit se v rámci 16 bitů odráží identifikátor oddílu. Pořadová čísla rovnoměrně zvětšující zvyšují a jsou gapless. Převezmou na 0, pokud je vyčerpán bit rozsahu 48-64. Tato vlastnost je jen ke čtení.                                                                |
| [`SessionId`](/dotnet/api/microsoft.azure.servicebus.message.sessionid) (ID skupiny)                  | U entit pracujících s relací určuje tato hodnota definovaná v relaci zprávu o přidružení zprávy. Zprávy se stejným identifikátorem relace se vztahují na souhrnný uzamykání a umožňují přesné zpracování a demultiplexování v daném pořadí. U entit, které nepoužívají relaci, je tato hodnota ignorována.                                                                                                                                     |
| [`Size`](/dotnet/api/microsoft.azure.servicebus.message.size)                                  | Odráží uloženou velikost zprávy v protokolu zprostředkovatele jako počet bajtů, které se počítají k kvótě úložiště. Tato vlastnost je jen ke čtení.                                                                                                                                                                                                                                                                                                       |
| [`State`](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.state)                                 | Určuje stav zprávy v protokolu. Tato vlastnost je relevantní pouze během procházení zpráv ("Náhled"), aby bylo možné určit, zda je zpráva "aktivní" a zda je k dispozici pro načtení, protože se dosáhne horní části fronty, bez ohledu na to, zda je odložena nebo čeká na naplánování. Tato vlastnost je jen ke čtení.                                                                                                                                           |
| [`TimeToLive`](/dotnet/api/microsoft.azure.servicebus.message.timetolive)                            | Tato hodnota je relativní doba, po jejímž uplynutí vyprší platnost zprávy, od okamžiku, kdy byla zpráva přijata a uložena zprostředkovatelem, jak je zachycena v **EnqueueTimeUtc**. Pokud není nastavena explicitně, je předpokládaná hodnota **DefaultTimeToLive** pro příslušnou frontu nebo téma. Hodnota **TimeToLive** na úrovni zprávy nemůže být delší než nastavení **DefaultTimeToLive** entity. Pokud je delší, bude upravena bez upozornění. |
| [Do](/dotnet/api/microsoft.azure.servicebus.message.to) (do)                               | Tato vlastnost je vyhrazena pro budoucí použití ve scénářích směrování a aktuálně je ignoruje samotným zprostředkovatelem. Aplikace mohou tuto hodnotu použít ve scénářích automatického dopředné řetězení založené na pravidlech k označení zamýšleného logického cíle zprávy.                                                                                                                                                                                   |
| [`ViaPartitionKey`](/dotnet/api/microsoft.azure.servicebus.message.viapartitionkey)                       | Pokud je zpráva odeslána přes frontu přenosu v oboru transakce, tato hodnota vybere oddíl fronta přenosu.                                                                                                                                                                                                                                                                                                                 |

Model abstraktní zprávy umožňuje odeslat zprávu do fronty prostřednictvím protokolu HTTPS a lze ji načíst prostřednictvím AMQP. V obou případech zpráva vypadá normální v kontextu příslušného protokolu. Vlastnosti zprostředkovatele jsou přeloženy podle potřeby a vlastnosti uživatele jsou mapovány na nejvhodnější umístění v příslušném modelu zprávy protokolu. V protokolu HTTP jsou vlastnosti uživatele mapovány přímo do a z hlaviček protokolu HTTP. v AMQP jsou mapovány na a z mapy **Vlastnosti aplikace** .

## <a name="message-routing-and-correlation"></a>Směrování a korelace zpráv

Podmnožina výše popsaných vlastností zprostředkovatele, konkrétně [pro](/dotnet/api/microsoft.azure.servicebus.message.to), [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto), [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid), [MessageID](/dotnet/api/microsoft.azure.servicebus.message.messageid), [ID](/dotnet/api/microsoft.azure.servicebus.message.correlationid)a [SessionID](/dotnet/api/microsoft.azure.servicebus.message.sessionid), slouží k usnadnění směrování zpráv do konkrétních míst. K ilustraci této funkce Vezměte v úvahu několik vzorů:

- **Jednoduchý požadavek/odpověď**: Vydavatel pošle zprávu do fronty a očekává odpověď od příjemce zprávy. Pro příjem odpovědi Vydavatel vlastní frontu, do které očekává doručení odpovědí. Adresa této fronty je vyjádřena ve vlastnosti **ReplyTo** odchozí zprávy. Když příjemce odpoví, zkopíruje identifikátor **MessageID** zprávy o zpracování do vlastnosti **ID korelace** zprávy s odpovědí a doručí zprávu do cíle označeného vlastností **ReplyTo** . Jedna zpráva může vracet více odpovědí v závislosti na kontextu aplikace.
- **Požadavek nebo odpověď vícesměrového vysílání**: jako variantu předchozího vzoru pošle Vydavatel zprávu do tématu a více předplatitelům bude mít nárok na tuto zprávu spotřebovat. Každý předplatitel může reagovat způsobem popsaným výše. Tento model se používá ve scénářích zjišťování nebo navracení se změnami a respondent obvykle identifikuje vlastnost uživatele nebo uvnitř datové části. Pokud **ReplyTo** odkazuje na téma, taková sada odpovědí zjišťování může být distribuována cílové skupině.
- **Multiplexing**: Tato funkce relace umožňuje multiplexování datových proudů souvisejících zpráv prostřednictvím jedné fronty nebo předplatného, aby se všechny relace (nebo skupiny) souvisejících zpráv, které jsou určené odpovídajícími hodnotami **SessionID** , směrovaly na konkrétního příjemce, zatímco příjemce udržuje relaci pod zámkem. Přečtěte si další informace o tom, jaké jsou podrobnosti [o relacích](message-sessions.md).
- **Multiplexovaná žádost o odpověď**: Tato funkce relace umožňuje přemultiplexované odpovědi, aby několik vydavatelů sdílelo frontu odpovědí. Nastavením **ReplyToSessionId** může vydavatel dát uživateli pokyn ke zkopírování této hodnoty do vlastnosti **SessionID** zprávy s odpovědí. Fronta nebo téma publikování nemusí být v relaci. Jak je zpráva odeslána, vydavatel pak může konkrétně počkat na relaci s daným **identifikátorem SessionID** , aby se vyhodnotit ve frontě, a to podmínkou přijetí přijímače relace. 

Směrování v rámci oboru názvů Service Bus lze realizovat pomocí pravidel pro dopřední řetězení a předplatného tématu. Směrování mezi obory názvů může být realizované [pomocí Azure LogicApps](https://azure.microsoft.com/services/logic-apps/). Jak je uvedeno v předchozím seznamu, vlastnost **to** je vyhrazena pro budoucí použití a může být nakonec interpretována zprostředkovatelem s funkcí speciálně povolenou. Aplikace, které chtějí implementovat směrování, by tak měly být založené na vlastnostech uživatele a nemusejí zacházet z štíhlé vlastnosti **to** ; to ale teď nezpůsobuje problémy s kompatibilitou.

## <a name="payload-serialization"></a>Serializace datové části

Při přenosu nebo uložení v rámci Service Bus je datová část vždy neprůhledný binární blok. Vlastnost [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) umožňuje aplikacím popsat datovou část s doporučeným formátem pro hodnoty vlastností, které jsou popisem typu obsahu MIME podle IETF RFC2045; například `application/json;charset=utf-8` .

Na rozdíl od variant Java nebo .NET Standard, .NET Framework verze rozhraní API Service Bus podporuje vytváření instancí **BrokeredMessage** předáním libovolných objektů .NET do konstruktoru. 

Při použití starší verze protokolu SBMP jsou tyto objekty serializovány pomocí výchozího binárního serializátoru nebo pomocí serializátoru, který je externě dodán. Při použití protokolu AMQP je objekt serializován do objektu AMQP. Příjemce může tyto objekty načíst pomocí metody [GetBody \<T> ()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.getbody#Microsoft_ServiceBus_Messaging_BrokeredMessage_GetBody__1) , a to zadáním očekávaného typu. Pomocí AMQP jsou objekty serializovány do grafu AMQP `ArrayList` objektů a a `IDictionary<string,object>` kterýkoli klient AMQP je může dekódovat. 

I když je tato skrytá serializace Magic užitečná, aplikace by měly přebírat explicitní kontrolu serializace objektů a přepínat své objekty do datových proudů před jejich zahrnutím do zprávy a vracet je zpět na straně přijímače. Výsledkem je interoperabilní výsledky. I když AMQP má výkonný binární kódovací model, je svázán s ekosystémem zasílání zpráv AMQP a klienti HTTP budou mít problémy dekódovat taková datová část. 

Varianty rozhraní API pro .NET Standard a Java přijímají pouze pole bajtů, což znamená, že aplikace musí zpracovat ovládací prvek serializace objektu. 

## <a name="next-steps"></a>Další kroky

Další informace o Service Bus zasílání zpráv najdete v následujících tématech:

* [Fronty, témata a odběry služby Service Bus](service-bus-queues-topics-subscriptions.md)
* [Začínáme s frontami služby Service Bus](service-bus-dotnet-get-started-with-queues.md)
* [Jak používat témata a odběry Service Bus](service-bus-dotnet-how-to-use-topics-subscriptions.md)
